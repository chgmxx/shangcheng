<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.mall.dao.order.MallOrderDAO">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.gt.mall.entity.order.MallOrder">
        <id column="id" property="id"/>
        <result column="order_no" property="orderNo"/>
        <result column="wx_order_no" property="wxOrderNo"/>
        <result column="receive_id" property="receiveId"/>
        <result column="order_money" property="orderMoney"/>
        <result column="order_freight_money" property="orderFreightMoney"/>
        <result column="order_old_money" property="orderOldMoney"/>
        <result column="order_buyer_message" property="orderBuyerMessage"/>
        <result column="order_seller_remark" property="orderSellerRemark"/>
        <result column="order_start" property="orderStart"/>
        <result column="order_pay_way" property="orderPayWay"/>
        <result column="delivery_method" property="deliveryMethod"/>
        <result column="appointment_name" property="appointmentName"/>
        <result column="appointment_telephone" property="appointmentTelephone"/>
        <result column="appointment_time" property="appointmentTime"/>
        <result column="invoice_title" property="invoiceTitle"/>
        <result column="take_their_id" property="takeTheirId"/>
        <result column="is_message_notice" property="isMessageNotice"/>
        <result column="buyer_user_id" property="buyerUserId"/>
        <result column="seller_user_id" property="sellerUserId"/>
        <result column="shop_id" property="shopId"/>
        <result column="order_status" property="orderStatus"/>
        <result column="create_time" property="createTime"/>
        <result column="order_pay_no" property="orderPayNo"/>
        <result column="pay_time" property="payTime"/>
        <result column="express_way" property="expressWay"/>
        <result column="express_id" property="expressId"/>
        <result column="express_number" property="expressNumber"/>
        <result column="express_time" property="expressTime"/>
        <result column="buyer_cancel_reason" property="buyerCancelReason"/>
        <result column="seller_cancel_reason" property="sellerCancelReason"/>
        <result column="update_time" property="updateTime"/>
        <result column="buyer_user_type" property="buyerUserType"/>
        <result column="order_pid" property="orderPid"/>
        <result column="mem_card_type" property="memCardType"/>
        <result column="give_status" property="giveStatus"/>
        <result column="group_buy_id" property="groupBuyId"/>
        <result column="order_type" property="orderType"/>
        <result column="p_join_id" property="pJoinId"/>
        <result column="coupon_code" property="couponCode"/>
        <result column="appointment_start_time" property="appointmentStartTime"/>
        <result column="appointment_end_time" property="appointmentEndTime"/>
        <result column="is_wallet" property="isWallet"/>
        <result column="bus_user_id" property="busUserId"/>
        <result column="receive_address" property="receiveAddress"/>
        <result column="receive_name" property="receiveName"/>
        <result column="receive_phone" property="receivePhone"/>
        <result column="flow_phone" property="flowPhone"/>
        <result column="flow_recharge_status" property="flowRechargeStatus"/>
        <result column="member_name" property="memberName" typeHandler="com.gt.mall.bean.ConvertBlobTypeHandler"/>
        <result column="use_jifen" property="useJifen"/>
        <result column="use_fenbi" property="useFenbi"/>
    </resultMap>

    <resultMap id="MoreResultMap" type="com.gt.mall.entity.order.MallOrder">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="order_no" property="orderNo" jdbcType="VARCHAR"/>
        <result column="wx_order_no" property="wxOrderNo" jdbcType="VARCHAR"/>
        <result column="receive_id" property="receiveId" jdbcType="INTEGER"/>
        <result column="order_money" property="orderMoney" jdbcType="DECIMAL"/>
        <result column="order_freight_money" property="orderFreightMoney" jdbcType="DECIMAL"/>
        <result column="order_buyer_message" property="orderBuyerMessage" jdbcType="VARCHAR"/>
        <result column="order_seller_remark" property="orderSellerRemark" jdbcType="VARCHAR"/>
        <result column="order_start" property="orderStart" jdbcType="INTEGER"/>
        <result column="order_pay_way" property="orderPayWay" jdbcType="INTEGER"/>
        <result column="delivery_method" property="deliveryMethod" jdbcType="INTEGER"/>
        <result column="appointment_name" property="appointmentName" jdbcType="VARCHAR"/>
        <result column="appointment_telephone" property="appointmentTelephone" jdbcType="VARCHAR"/>
        <result column="appointment_time" property="appointmentTime" jdbcType="TIMESTAMP"/>
        <result column="invoice_title" property="invoiceTitle" jdbcType="VARCHAR"/>
        <result column="take_their_id" property="takeTheirId" jdbcType="INTEGER"/>
        <result column="is_message_notice" property="isMessageNotice" jdbcType="INTEGER"/>
        <result column="buyer_user_id" property="buyerUserId" jdbcType="INTEGER"/>
        <result column="seller_user_id" property="sellerUserId" jdbcType="INTEGER"/>
        <result column="shop_id" property="shopId" jdbcType="INTEGER"/>
        <result column="order_status" property="orderStatus" jdbcType="INTEGER"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="order_pay_no" property="orderPayNo" jdbcType="VARCHAR"/>
        <result column="pay_time" property="payTime" jdbcType="TIMESTAMP"/>
        <result column="express_way" property="expressWay" jdbcType="INTEGER"/>
        <result column="express_id" property="expressId" jdbcType="INTEGER"/>
        <result column="express_number" property="expressNumber" jdbcType="VARCHAR"/>
        <result column="express_time" property="expressTime" jdbcType="TIMESTAMP"/>
        <result column="buyer_cancel_reason" property="buyerCancelReason" jdbcType="INTEGER"/>
        <result column="seller_cancel_reason" property="sellerCancelReason" jdbcType="INTEGER"/>
        <!-- <result column="mem_name" property="recUserName" jdbcType="VARCHAR" />-->
        <!-- <result column="mem_phone" property="recTelephone" jdbcType="VARCHAR" />-->
        <result column="updateDay" property="updateDay" jdbcType="INTEGER"/>
        <result column="orderPNo" property="orderPNo" jdbcType="VARCHAR"/>
        <result column="sto_name" property="shopName" jdbcType="VARCHAR"/>
        <result column="order_old_money" property="orderOldMoney" jdbcType="DECIMAL"/>
        <result column="mem_card_type" property="memCardType" jdbcType="INTEGER"/>
        <result column="group_buy_id" property="groupBuyId" jdbcType="INTEGER"/>
        <result column="order_type" property="orderType" jdbcType="INTEGER"/>
        <result column="p_join_id" property="pJoinId" jdbcType="INTEGER"/>
        <result column="coupon_code" property="couponCode" jdbcType="VARCHAR"/>
        <result column="appointment_start_time" property="appointmentStartTime" jdbcType="VARCHAR"/>
        <result column="appointment_end_time" property="appointmentEndTime" jdbcType="VARCHAR"/>
        <result column="order_pid" property="orderPid" jdbcType="INTEGER"/>
        <!--<result column="address" property="recAddress" jdbcType="VARCHAR"/>-->
        <result column="is_wallet" property="isWallet" jdbcType="INTEGER"/>
        <result column="bus_user_id" property="busUserId" jdbcType="INTEGER"/>
        <result column="receive_address" property="receiveAddress" jdbcType="VARCHAR"/>
        <result column="receive_name" property="receiveName" jdbcType="VARCHAR"/>
        <result column="receive_phone" property="receivePhone" jdbcType="VARCHAR"/>
        <result column="flow_phone" property="flowPhone" jdbcType="VARCHAR"/>
        <result column="member_name" property="memberName" jdbcType="VARCHAR" typeHandler="com.gt.mall.bean.ConvertBlobTypeHandler"/>
        <result column="use_jifen" property="useJifen"/>
        <result column="use_fenbi" property="useFenbi"/>
        <collection property="mallOrderDetail" column="id" ofType="com.gt.mall.entity.order.MallOrderDetail">
            <id column="dId" property="id" jdbcType="INTEGER"/>
            <result column="order_id" property="orderId" jdbcType="INTEGER"/>
            <result column="product_id" property="productId" jdbcType="INTEGER"/>
            <result column="shop_id" property="shopId" jdbcType="INTEGER"/>
            <result column="product_specificas" property="productSpecificas" jdbcType="VARCHAR"/>
            <result column="product_image_url" property="productImageUrl" jdbcType="VARCHAR"/>
            <result column="det_pro_num" property="detProNum" jdbcType="INTEGER"/>
            <result column="det_pro_price" property="detProPrice" jdbcType="DECIMAL"/>
            <result column="det_pro_name" property="detProName" jdbcType="VARCHAR"/>
            <result column="det_pro_code" property="detProCode" jdbcType="VARCHAR"/>
            <result column="det_privivilege" property="detPrivivilege" jdbcType="DECIMAL"/>
            <result column="det_pro_message" property="detProMessage" jdbcType="VARCHAR"/>
            <result column="product_speciname" property="productSpeciname" jdbcType="VARCHAR"/>
            <result column="status" property="status" jdbcType="INTEGER"/>
            <result column="returnDay" property="returnDay" jdbcType="INTEGER"/>
            <result column="discount" property="discount" jdbcType="INTEGER"/>
            <result column="is_return" property="isReturn" jdbcType="TINYINT"/>
            <result column="pro_type_id" property="proTypeId" jdbcType="INTEGER"/>
            <result column="use_fenbi" property="useFenbi" jdbcType="INTEGER"/>
            <result column="use_jifen" property="useJifen" jdbcType="DOUBLE"/>
            <result column="appraise_status" property="appraiseStatus" jdbcType="INTEGER"/>
            <result column="total_price" property="totalPrice" jdbcType="DOUBLE"/>
            <result column="card_receive_id" property="cardReceiveId" jdbcType="INTEGER"/>
            <result column="duofen_coupon" property="duofenCoupon" jdbcType="VARCHAR"/>
            <result column="coupon_code" property="couponCode" jdbcType="VARCHAR"/>
            <result column="use_card_id" property="useCardId" jdbcType="INTEGER"/>
            <result column="commission" property="commission" jdbcType="DECIMAL"/>
            <result column="sale_member_id" property="saleMemberId" jdbcType="INTEGER"/>
            <result column="discounted_prices" property="discountedPrices" jdbcType="DECIMAL"/>
            <result column="integral_youhui" property="integralYouhui" jdbcType="DECIMAL"/>
            <result column="fenbi_youhui" property="fenbiYouhui" jdbcType="DECIMAL"/>
            <result column="flow_id" property="flowId" jdbcType="INTEGER"/>
            <result column="flow_record_id" property="flowRecordId" jdbcType="INTEGER"/>
            <collection property="orderReturn" column="dId" ofType="com.gt.mall.entity.order.MallOrderReturn">
                <id column="rId" property="id" jdbcType="INTEGER"/>
                <result column="order_id" property="orderId" jdbcType="INTEGER"/>
                <result column="order_detail_id" property="orderDetailId" jdbcType="INTEGER"/>
                <result column="return_no" property="returnNo" jdbcType="VARCHAR"/>
                <result column="ret_handling_way" property="retHandlingWay" jdbcType="TINYINT"/>
                <result column="ret_reason_id" property="retReasonId" jdbcType="INTEGER"/>
                <result column="ret_reason" property="retReason" jdbcType="VARCHAR"/>
                <result column="ret_money" property="retMoney" jdbcType="DECIMAL"/>
                <result column="ret_telephone" property="retTelephone" jdbcType="INTEGER"/>
                <result column="ret_remark" property="retRemark" jdbcType="VARCHAR"/>
                <result column="images_url" property="imagesUrl" jdbcType="VARCHAR"/>
                <result column="shop_id" property="shopId" jdbcType="INTEGER"/>
                <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
                <result column="status" property="status" jdbcType="INTEGER"/>
                <result column="user_id" property="userId" jdbcType="INTEGER"/>
                <result column="no_return_reason" property="noReturnReason" jdbcType="VARCHAR"/>
                <result column="return_address" property="returnAddress" jdbcType="VARCHAR"/>
            </collection>
        </collection>
    </resultMap>

    <resultMap id="PhoneResultMap" type="com.gt.mall.entity.order.MallOrder">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="order_no" property="orderNo" jdbcType="VARCHAR"/>
        <result column="wx_order_no" property="wxOrderNo" jdbcType="VARCHAR"/>
        <result column="receive_id" property="receiveId" jdbcType="INTEGER"/>
        <result column="order_money" property="orderMoney" jdbcType="DECIMAL"/>
        <result column="order_freight_money" property="orderFreightMoney" jdbcType="DECIMAL"/>
        <result column="order_buyer_message" property="orderBuyerMessage" jdbcType="VARCHAR"/>
        <result column="order_seller_remark" property="orderSellerRemark" jdbcType="VARCHAR"/>
        <result column="order_start" property="orderStart" jdbcType="INTEGER"/>
        <result column="order_pay_way" property="orderPayWay" jdbcType="INTEGER"/>
        <result column="delivery_method" property="deliveryMethod" jdbcType="INTEGER"/>
        <result column="appointment_name" property="appointmentName" jdbcType="VARCHAR"/>
        <result column="appointment_telephone" property="appointmentTelephone" jdbcType="VARCHAR"/>
        <result column="appointment_time" property="appointmentTime" jdbcType="TIMESTAMP"/>
        <result column="invoice_title" property="invoiceTitle" jdbcType="VARCHAR"/>
        <result column="take_their_id" property="takeTheirId" jdbcType="INTEGER"/>
        <result column="is_message_notice" property="isMessageNotice" jdbcType="INTEGER"/>
        <result column="buyer_user_id" property="buyerUserId" jdbcType="INTEGER"/>
        <result column="seller_user_id" property="sellerUserId" jdbcType="INTEGER"/>
        <result column="shop_id" property="shopId" jdbcType="INTEGER"/>
        <result column="order_status" property="orderStatus" jdbcType="INTEGER"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="order_pay_no" property="orderPayNo" jdbcType="VARCHAR"/>
        <result column="pay_time" property="payTime" jdbcType="TIMESTAMP"/>
        <result column="express_way" property="expressWay" jdbcType="INTEGER"/>
        <result column="express_id" property="expressId" jdbcType="INTEGER"/>
        <result column="express_number" property="expressNumber" jdbcType="VARCHAR"/>
        <result column="express_time" property="expressTime" jdbcType="TIMESTAMP"/>
        <result column="buyer_cancel_reason" property="buyerCancelReason" jdbcType="INTEGER"/>
        <result column="seller_cancel_reason" property="sellerCancelReason" jdbcType="INTEGER"/>
        <!-- <result column="mem_name" property="recUserName" jdbcType="VARCHAR" />
         <result column="mem_phone" property="recTelephone" jdbcType="VARCHAR" />-->
        <result column="updateDay" property="updateDay" jdbcType="INTEGER"/>
        <result column="orderPNo" property="orderPNo" jdbcType="VARCHAR"/>
        <result column="order_old_money" property="orderOldMoney" jdbcType="DECIMAL"/>
        <result column="mem_card_type" property="memCardType" jdbcType="INTEGER"/>
        <result column="group_buy_id" property="groupBuyId" jdbcType="INTEGER"/>
        <result column="order_type" property="orderType" jdbcType="INTEGER"/>
        <result column="p_join_id" property="pJoinId" jdbcType="INTEGER"/>
        <result column="coupon_code" property="couponCode" jdbcType="VARCHAR"/>
        <result column="appointment_start_time" property="appointmentStartTime" jdbcType="VARCHAR"/>
        <result column="appointment_end_time" property="appointmentEndTime" jdbcType="VARCHAR"/>
        <!-- <result column="address" property="recAddress" jdbcType="VARCHAR"/>-->
        <result column="is_wallet" property="isWallet" jdbcType="INTEGER"/>
        <result column="bus_user_id" property="busUserId" jdbcType="INTEGER"/>
        <result column="receive_address" property="receiveAddress" jdbcType="VARCHAR"/>
        <result column="receive_name" property="receiveName" jdbcType="VARCHAR"/>
        <result column="receive_phone" property="receivePhone" jdbcType="VARCHAR"/>
        <result column="flow_phone" property="flowPhone" jdbcType="VARCHAR"/>
        <result column="member_name" property="memberName" jdbcType="VARCHAR" typeHandler="com.gt.mall.bean.ConvertBlobTypeHandler"/>
        <result column="use_jifen" property="useJifen"/>
        <result column="use_fenbi" property="useFenbi"/>
        <collection property="mallOrderDetail" ofType="com.gt.mall.entity.order.MallOrderDetail">
            <id column="dId" property="id" jdbcType="INTEGER"/>
            <result column="order_id" property="orderId" jdbcType="INTEGER"/>
            <result column="product_id" property="productId" jdbcType="INTEGER"/>
            <result column="shop_id" property="shopId" jdbcType="INTEGER"/>
            <result column="product_specificas" property="productSpecificas" jdbcType="VARCHAR"/>
            <result column="product_image_url" property="productImageUrl" jdbcType="VARCHAR"/>
            <result column="det_pro_num" property="detProNum" jdbcType="INTEGER"/>
            <result column="det_pro_price" property="detProPrice" jdbcType="DECIMAL"/>
            <result column="det_pro_name" property="detProName" jdbcType="VARCHAR"/>
            <result column="det_pro_code" property="detProCode" jdbcType="VARCHAR"/>
            <result column="det_privivilege" property="detPrivivilege" jdbcType="DECIMAL"/>
            <result column="det_pro_message" property="detProMessage" jdbcType="VARCHAR"/>
            <result column="product_speciname" property="productSpeciname" jdbcType="VARCHAR"/>
            <result column="status" property="status" jdbcType="INTEGER"/>
            <result column="returnDay" property="returnDay" jdbcType="INTEGER"/>
            <result column="discount" property="discount" jdbcType="INTEGER"/>
            <result column="pro_type_id" property="proTypeId" jdbcType="INTEGER"/>
            <result column="use_fenbi" property="useFenbi" jdbcType="INTEGER"/>
            <result column="use_jifen" property="useJifen" jdbcType="DOUBLE"/>
            <result column="coupon_code" property="couponCode" jdbcType="VARCHAR"/>
            <result column="use_card_id" property="useCardId" jdbcType="INTEGER"/>
            <result column="integral_youhui" property="integralYouhui" jdbcType="DECIMAL"/>
            <result column="fenbi_youhui" property="fenbiYouhui" jdbcType="DECIMAL"/>
            <result column="flow_id" property="flowId" jdbcType="INTEGER"/>
            <result column="flow_record_id" property="flowRecordId" jdbcType="INTEGER"/>
            <result column="appraise_status" property="appraiseStatus" jdbcType="INTEGER"/>
            <collection property="orderReturn" column="dId" ofType="com.gt.mall.entity.order.MallOrderReturn">
                <id column="rId" property="id" jdbcType="INTEGER"/>
                <result column="order_id" property="orderId" jdbcType="INTEGER"/>
                <result column="order_detail_id" property="orderDetailId" jdbcType="INTEGER"/>
                <result column="return_no" property="returnNo" jdbcType="VARCHAR"/>
                <result column="ret_handling_way" property="retHandlingWay" jdbcType="TINYINT"/>
                <result column="ret_reason_id" property="retReasonId" jdbcType="INTEGER"/>
                <result column="ret_reason" property="retReason" jdbcType="VARCHAR"/>
                <result column="ret_money" property="retMoney" jdbcType="DECIMAL"/>
                <result column="ret_telephone" property="retTelephone" jdbcType="INTEGER"/>
                <result column="ret_remark" property="retRemark" jdbcType="VARCHAR"/>
                <result column="images_url" property="imagesUrl" jdbcType="VARCHAR"/>
                <result column="shop_id" property="shopId" jdbcType="INTEGER"/>
                <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
                <result column="status" property="status" jdbcType="INTEGER"/>
                <result column="user_id" property="userId" jdbcType="INTEGER"/>
                <result column="no_return_reason" property="noReturnReason" jdbcType="VARCHAR"/>
                <result column="return_address" property="returnAddress" jdbcType="VARCHAR"/>
            </collection>
        </collection>
    </resultMap>

    <resultMap id="orderDetailList" type="com.gt.mall.entity.order.MallOrderDetail">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="order_id" property="orderId" jdbcType="INTEGER"/>
        <result column="product_id" property="productId" jdbcType="INTEGER"/>
        <result column="shop_id" property="shopId" jdbcType="INTEGER"/>
        <result column="product_specificas" property="productSpecificas" jdbcType="VARCHAR"/>
        <result column="product_image_url" property="productImageUrl" jdbcType="VARCHAR"/>
        <result column="det_pro_num" property="detProNum" jdbcType="INTEGER"/>
        <result column="det_pro_name" property="detProName" jdbcType="VARCHAR"/>
        <result column="det_pro_code" property="detProCode" jdbcType="VARCHAR"/>
        <result column="det_privivilege" property="detPrivivilege" jdbcType="DECIMAL"/>
        <result column="det_pro_message" property="detProMessage" jdbcType="VARCHAR"/>
        <result column="product_speciname" property="productSpeciname" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="returnDay" property="returnDay" jdbcType="INTEGER"/>
        <result column="discount" property="discount" jdbcType="INTEGER"/>
        <result column="pro_type_id" property="proTypeId" jdbcType="INTEGER"/>
        <result column="det_pro_price" property="detProPrice" jdbcType="DECIMAL"/>
        <result column="coupon_code" property="couponCode" jdbcType="VARCHAR"/>
        <result column="discounted_prices" property="discountedPrices" jdbcType="DECIMAL"/>
        <result column="det_pro_price" property="detProPrice" jdbcType="DECIMAL"/>
        <result column="use_fenbi" property="useFenbi" jdbcType="DECIMAL"/>
        <result column="use_jifen" property="useJifen" jdbcType="INTEGER"/>
        <result column="total_price" property="totalPrice" jdbcType="DOUBLE"/>
        <result column="appraise_status" property="appraiseStatus" jdbcType="INTEGER"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, order_no, wx_order_no, receive_id, order_money, order_freight_money, order_buyer_message, order_seller_remark,
        order_start, order_pay_way, delivery_method, appointment_name, appointment_telephone, appointment_time,invoice_title,
        take_their_id, is_message_notice, buyer_user_id, seller_user_id, shop_id, order_status, create_time,order_pay_no,
        pay_time,express_way,express_id,express_number,express_time,buyer_cancel_reason,seller_cancel_reason,mem_card_type,
        order_old_money,order_type,coupon_code, order_type,bus_user_id,receive_address,receive_name,receive_phone, flow_phone,use_jifen,use_fenbi
    </sql>

    <sql id="More_Column_List">
        t.id, t.order_no,t.receive_id,t.order_money, t.order_freight_money, t.order_buyer_message,t.order_seller_remark,
        t.order_start,t.order_pay_way,t.delivery_method,t.invoice_title,t.take_their_id,t.is_message_notice, t.buyer_user_id,
        t.seller_user_id,t.order_status,t.create_time,t.order_pay_no,t.pay_time,express_way,t.express_id,t.express_number,
        t.express_time,t.buyer_cancel_reason,t.seller_cancel_reason ,t.receive_name,t.receive_phone,t.member_name,
        d.order_id,d.product_specificas,d.product_image_url,  d.det_pro_num,d.det_pro_price,d.det_pro_name,d.det_pro_code,d.det_privivilege,
        d.status ,d.id as dId,d.shop_id,re.ret_reason,re.id as rId,re.no_return_reason,re.return_no,re.ret_handling_way,re.ret_reason_id,
        re.ret_reason,re.ret_money,re.ret_telephone,re.ret_remark,re.images_url,re.return_address,
        TIMESTAMPDIFF(DAY,t.update_time,now()) as updateDay,t.bus_user_id,t.use_jifen,t.use_fenbi
    </sql>
    <sql id="Phone_Order_Column_List">
        t.id, t.order_no,t.order_money, t.order_freight_money, t.order_status,t.create_time,t.order_pay_no,t.express_number,t.pay_time,
        t.express_time,t.order_pay_way,t.receive_name,t.receive_phone,t.member_name,
        u.nickname,TIMESTAMPDIFF(DAY,t.update_time,now()) as updateDay,
        if(t.order_pid = 0 || t.order_pid is null,t.order_no,(SELECT  order_no from t_mall_order where t.order_pid=id)) as orderPNo
    </sql>

    <sql id="Buyer_Order_Column_List">
         t.id, t.order_no,t.order_money, t.order_freight_money, t.order_status,t.create_time,t.order_pay_no,t.express_number,t.pay_time,
        t.express_time, TIMESTAMPDIFF(DAY,t.update_time,NOW()) AS updateDay,t.order_type,t.group_buy_id,t.order_pay_way,t.delivery_method,t.order_pid,
        IF(t.order_pid = 0 || t.order_pid IS NULL,t.order_no,(SELECT order_no FROM t_mall_order WHERE t.order_pid=id)) AS orderPNo,
        t.is_wallet,t.bus_user_id ,d.order_id,d.product_specificas,d.product_image_url,d.det_pro_num,d.det_pro_price,d.det_pro_name,
        d.status,d.product_id,d.id AS dId, d.shop_id, d.product_speciname,p.is_return,d.pro_type_id,d.det_privivilege,d.return_day AS returnDay,
        d.use_fenbi,d.use_fenbi,d.appraise_status,d.sale_member_id ,re.id AS rId,re.no_return_reason,re.return_no, re.ret_reason,re.ret_handling_way,
        re.ret_money, s.sto_name
     </sql>

    <sql id="Order_OrderDetail_List">
        t.id, t.order_no,t.receive_id,t.order_money, t.order_freight_money, t.order_buyer_message,t.order_seller_remark,
        t.order_start,t.order_pay_way,t.delivery_method,t.invoice_title,t.take_their_id,t.is_message_notice, t.buyer_user_id,
        t.seller_user_id,t.order_status,t.create_time,t.order_pay_no,t.pay_time,express_way,t.express_id,t.express_number,
        t.express_time,t.buyer_cancel_reason,t.seller_cancel_reason,t.mem_card_type,t.group_buy_id,t.order_type,t.p_join_id,
        d.order_id,d.product_specificas,d.product_image_url,d.product_id,d.det_pro_num,d.det_pro_price,d.det_pro_name,
        d.det_pro_code,d.det_privivilege,d.status ,d.id as dId,t.shop_id,s.sto_name,t.order_old_money,t.coupon_code as couponCode,p.is_return,
        d.pro_type_id,t.appointment_name,t.appointment_telephone,t.appointment_time,t.appointment_start_time,t.appointment_end_time
        ,t.order_pid,d.use_fenbi,d.use_jifen,d.return_day as returnDay,d.total_price,d.card_receive_id,d.duofen_coupon,d.coupon_code,
        d.use_card_id,d.commission,d.sale_member_id,t.bus_user_id,d.discounted_prices,d.flow_id,d.flow_record_id, t.flow_phone,t.buyer_user_type
    </sql>

    <select id="selectOrderByAuctId" resultType="java.util.Map">
        SELECT id,order_status
        FROM t_mall_order
        WHERE order_type = 4 AND order_status > 1 AND group_buy_id = #{auctId}
        limit 1
    </select>

    <select id="count" parameterType="map" resultType="java.lang.Integer">
        select count(DISTINCT t.id)
        from t_mall_order t
        WHERE 1=1
        <if test="userId != null and userId != ''">
            and t.bus_user_id = #{userId}
        </if>
        AND ((t.order_pay_way = 5 AND t.order_status != 1 AND t.order_status != 5) OR (t.order_pay_way!=5 ) )
        <if test="startTime != null and startTime != ''">
            and t.create_time >= #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            and t.create_time <![CDATA[<=]]> #{endTime}
        </if>
        <if test="status != null and status != ''">
            <if test="status &lt; 6">
                and t.order_status = #{status}
            </if>
        </if>
        <if test="orderType != 0">
            <if test="orderType == 1">and t.order_status = #{orderType}</if>
            <if test="orderType == 2">and t.delivery_method = #{orderType}</if>
            <if test="orderType == 3">and t.order_pay_way = 2</if>
        </if>
        <if test="orderFilter != 0">
            <if test="orderFilter == 1">and t.order_no = #{orderNo}<!-- and t.order_no like CONCAT(CONCAT('%', #{orderNo}),'%')  --></if>
            <if test="orderFilter == 2"><!-- and order_no = #{orderNo} --></if>
            <if test="orderFilter == 3">and t.receive_name = #{orderNo}<!-- and t.receive_name like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
            <if test="orderFilter == 4">and t.receive_phone = #{orderNo}<!-- and t.receive_phone like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
            <if test="orderFilter == 5">and t.member_name = #{orderNo}<!-- and t.member_name like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
        </if>
        <if test="shoplist != null ">
            and
            <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                t.shop_id = #{item.id,jdbcType=INTEGER}
            </foreach>
        </if>
    </select>
    <select id="findByPage" resultMap="PhoneResultMap" parameterType="map">
        SELECT t.id, t.order_no,t.order_money, t.order_freight_money, t.order_status,t.create_time,t.order_pay_no,t.express_number,t.pay_time,
        t.express_time,t.order_pay_way,t.group_buy_id, t.receive_name,t.receive_phone,t.receive_address , TIMESTAMPDIFF(DAY,t.update_time,NOW()) AS update_time,
        t.delivery_method,t.is_wallet,t.`shop_id`,t.buyer_user_id , t.member_name
        FROM t_mall_order t
        <where>
            <if test="userId != null and userId != ''">
                and t.bus_user_id = #{userId}
            </if>
            <if test="shoplist != null ">
                and
                <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                    t.shop_id = #{item.id,jdbcType=INTEGER}
                </foreach>
            </if>
            <if test="startTime != null and startTime != ''">
                and t.create_time >= #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                and t.create_time <![CDATA[<=]]> #{endTime}
            </if>
            <if test="orderType != 0">
                <if test="orderType == 1">and t.order_status = #{orderType}</if>
                <if test="orderType == 2">and t.delivery_method = #{orderType}</if>
                <if test="orderType == 3">and t.order_pay_way = 2</if>
            </if>
            <if test="status != null and status != ''">
                <if test="status &lt; 6">
                    and t.order_status = #{status}
                </if>
            </if>
            <if test="orderFilter != 0">
                <if test="orderFilter == 1">and t.order_no = #{orderNo}<!-- and t.order_no like CONCAT(CONCAT('%', #{orderNo}),'%')  --></if>
                <if test="orderFilter == 2"><!-- and order_no = #{orderNo} --></if>
                <if test="orderFilter == 3">and t.receive_name = #{orderNo}<!-- and t.receive_name like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
                <if test="orderFilter == 4">and t.receive_phone = #{orderNo}<!-- and t.receive_phone like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
                <if test="orderFilter == 5">and t.member_name = #{orderNo}<!-- and t.member_name like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
            </if>
            and ((t.order_pay_way = 5 AND t.order_status != 1 AND t.order_status != 5) OR (t.order_pay_way!=5 ) )
        </where>
        ORDER BY t.id desc
        <if test="firstResult != null and maxResult != null">
            limit #{firstResult},#{maxResult}
        </if>
    </select>
    <select id="countReturn" parameterType="map" resultType="java.lang.Integer">
        SELECT count(distinct t.id)
        FROM
        (
        SELECT
        t.id, t.order_no,t.order_money, t.order_freight_money, t.order_status,t.create_time,t.order_pay_no,t.express_number,t.pay_time,
        t.express_time,t.order_pay_way,t.group_buy_id, t.receive_name,t.receive_phone,t.receive_address,t.update_time ,
        t.delivery_method,t.is_wallet,t.buyer_user_id, t.member_name
        FROM t_mall_order t
        <where>
            ((t.order_pay_way = 5 AND t.order_status != 1 AND t.order_status != 5) or (t.order_pay_way!=5))
            <if test="userId != null and userId != ''">
                and t.bus_user_id = #{userId}
            </if>
            <if test="shoplist != null ">
                and
                <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                    t.shop_id = #{item.id,jdbcType=INTEGER}
                </foreach>
            </if>
            <if test="startTime != null and startTime != ''">
                and t.create_time >= #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                and t.create_time <![CDATA[<=]]> #{endTime}
            </if>
            <if test="orderType != 0">
                <if test="orderType == 1">and t.order_status = #{orderType}</if>
                <if test="orderType == 2">and t.delivery_method = #{orderType}</if>
                <if test="orderType == 3">and t.order_pay_way = 2</if>
            </if>
            <if test="status != null and status != ''">
                <if test="status == 6 || status == 8">
                    and t.order_status != 1
                </if>
            </if>
            <if test="orderFilter != 0">
                <if test="orderFilter == 1">and t.order_no = #{orderNo}<!-- and t.order_no like CONCAT(CONCAT('%', #{orderNo}),'%')  --></if>
                <if test="orderFilter == 2"><!-- and order_no = #{orderNo} --></if>
                <if test="orderFilter == 3">and t.receive_name = #{orderNo}<!-- and t.receive_name like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
                <if test="orderFilter == 4">and t.receive_phone = #{orderNo}<!-- and t.receive_phone like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
                <if test="orderFilter == 5">and t.member_name = #{orderNo}<!-- and t.member_name like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
            </if>
        </where>
        )
        AS t
        LEFT JOIN t_mall_order_detail d ON t.`id`=d.`order_id`
        WHERE ((t.order_pay_way = 5 AND t.order_status != 1 AND t.order_status != 5) or (t.order_pay_way!=5 AND d.id > 0))
        <if test="shoplist != null ">
            and
            <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                d.shop_id = #{item.id,jdbcType=INTEGER}
            </foreach>
        </if>
        <if test="status != null and status != ''">
            <if test="status == 6 || status == 8">
                and d.status != -3 and d.status != 1 and d.status != 5 and d.status != -2
            </if>
            <if test="status == 7">
                and d.status != -3
            </if>
            <if test="status == 9">
                and d.status != -3 and d.status != 0 and d.status != 2 and d.status != 3 and d.status != 4 and d.status != -1
            </if>
        </if>
    </select>
    <select id="findReturnByPage" resultMap="PhoneResultMap" parameterType="map">
        SELECT t.id, t.order_no,t.order_money, t.order_freight_money, t.order_status,t.create_time,t.order_pay_no,t.express_number,t.pay_time,
        t.express_time,t.order_pay_way,t.group_buy_id, t.receive_name,t.receive_phone,t.receive_address,t.update_time AS updateDay,
        t.delivery_method,t.is_wallet,t.buyer_user_id, t.member_name

        ,d.order_id,d.product_specificas,d.product_image_url,d.det_pro_num,d.det_pro_price,d.det_pro_name, d.status,d.product_id,d.id AS dId,d.shop_id,d.product_speciname

        FROM
        (
        SELECT
        t.id, t.order_no,t.order_money, t.order_freight_money, t.order_status,t.create_time,t.order_pay_no,t.express_number,t.pay_time,
        t.express_time,t.order_pay_way,t.group_buy_id, t.receive_name,t.receive_phone,t.receive_address,t.update_time ,
        t.delivery_method,t.is_wallet,t.buyer_user_id, t.member_name
        FROM t_mall_order t
        <where>
            ((t.order_pay_way = 5 AND t.order_status != 1 AND t.order_status != 5) or (t.order_pay_way!=5))
            <if test="userId != null and userId != ''">
                and t.bus_user_id = #{userId}
            </if>
            <if test="shoplist != null ">
                and
                <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                    t.shop_id = #{item.id,jdbcType=INTEGER}
                </foreach>
            </if>
            <if test="startTime != null and startTime != ''">
                and t.create_time >= #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                and t.create_time <![CDATA[<=]]> #{endTime}
            </if>
            <if test="orderType != 0">
                <if test="orderType == 1">and t.order_status = #{orderType}</if>
                <if test="orderType == 2">and t.delivery_method = #{orderType}</if>
                <if test="orderType == 3">and t.order_pay_way = 2</if>
            </if>
            <if test="status != null and status != ''">
                <if test="status == 6 || status == 8">
                    and t.order_status != 1
                </if>
            </if>
            <if test="orderFilter != 0">
                <if test="orderFilter == 1">and t.order_no = #{orderNo}<!-- and t.order_no like CONCAT(CONCAT('%', #{orderNo}),'%')  --></if>
                <if test="orderFilter == 2"><!-- and order_no = #{orderNo} --></if>
                <if test="orderFilter == 3">and t.receive_name = #{orderNo}<!-- and t.receive_name like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
                <if test="orderFilter == 4">and t.receive_phone = #{orderNo}<!-- and t.receive_phone like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
                <if test="orderFilter == 5">and t.member_name = #{orderNo}<!-- and t.member_name like CONCAT(CONCAT('%', #{orderNo}),'%') --></if>
            </if>
        </where>
        )
        AS t
        LEFT JOIN t_mall_order_detail d ON t.`id`=d.`order_id`
        WHERE ((t.order_pay_way = 5 AND t.order_status != 1 AND t.order_status != 5) or (t.order_pay_way!=5 AND d.id > 0))
        <if test="shoplist != null">
            and
            <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                d.shop_id = #{item.id,jdbcType=INTEGER}
            </foreach>
        </if>
        <if test="status != null and status != ''">
            <if test="status == 6 || status == 8">
                <!-- and ( d.status = 0 or d.status = 2 or d.status = 3 or d.status = 4 or d.status = -1) -->

                and d.status != -3 and d.status != 1 and d.status != 5 and d.status != -2
            </if>
            <if test="status == 7">
                and d.status != -3
            </if>
            <if test="status == 9">
                <!-- and (d.status = 1 or d.status = 5 or d.status = -2) -->

                and d.status != -3 and d.status != 0 and d.status != 2 and d.status != 3 and d.status != 4 and d.status != -1
            </if>
        </if>
        ORDER BY t.id desc
        <if test="firstResult != null and maxResult != null">
            limit #{firstResult},#{maxResult}
        </if>
    </select>

    <select id="findOrderDetailById" resultType="map" parameterType="map">
        SELECT d.order_id,d.product_specificas,d.product_image_url,d.det_pro_num,d.det_pro_price,d.det_pro_name,
        d.status,d.product_id,d.id as dId,d.shop_id,d.product_speciname,re.ret_reason,re.id as rId,
        re.no_return_reason,re.return_no,re.ret_reason,re.ret_handling_way,re.ret_money
        from t_mall_order_detail d
        left join t_mall_order_return re on re.order_detail_id=d.id
        where 1=1
        and d.order_id = #{id}
        <if test="status != null and status != ''">
            <if test="status == 6 || status == 8">
                and ( d.status = 0 or d.status = 2 or d.status = 3 or d.status = 4 or d.status = -1)
            </if>
            <if test="status == 7">
                and d.status != -3
            </if>
            <if test="status == 9">
                and (d.status = 1 or d.status = 5 or d.status = -2)
            </if>
        </if>
    </select>

    <update id="upOrderNoOrRemark" parameterType="com.gt.mall.entity.order.MallOrder">
        update t_mall_order set update_time = now()
        <choose>
            <when test="status != '' and status != null">
                ,order_status = #{status}
            </when>
            <when test="express != '' and express != null">
                ,express_time = now()
                <if test="expressWay != '' and expressWay != null">
                    ,express_way = #{expressWay}
                </if>
                <if test="expressId != 0">
                    ,express_id = #{expressId}
                </if>
                <if test="expressDelivery != '' and expressDelivery != null">
                    ,express_number = #{expressDelivery}
                </if>
            </when>
            <otherwise>
                <if test="orderSellerRemark != '' and orderSellerRemark != null">
                    ,order_seller_remark = #{orderSellerRemark}
                </if>
                <if test="orderMoney != '' and orderMoney != null">
                    ,order_money = #{orderMoney}
                </if>
                <if test="sellerReason != '' and sellerReason != null">
                    ,seller_cancel_reason = #{sellerReason}
                </if>
                <if test="buyerReason != '' and buyerReason != null">
                    ,buyer_cancel_reason = #{buyerReason}
                </if>
            </otherwise>
        </choose>
        where id = #{orderId}
    </update>

    <select id="selectOrderDetail" resultType="Map" parameterType="map">
        select t.*,
        (
          select GROUP_CONCAT(s.specifica_value)
          from t_mall_product_specifica  s
          where CONCAT(',',t.product_specificas,',')  like CONCAT('%',CONCAT(',',s.specifica_value_id,','),'%')
          and s.product_id=t.product_id
        ) as proSpec,
        r.id as rId ,r.`status` as rStatus,r.ret_handling_way as handlingWay,
        r.ret_reason_id as reasonId,r.ret_reason as reason ,r.ret_remark as remark,r.ret_money as money,r.no_return_reason as noReason,
        r.return_address as returnAddress
        from t_mall_order_detail t
        left join t_mall_order_return r on t.id = r.order_detail_id and r.`status` != -1
        where t.order_id = #{orderId}
    </select>

    <!-- 关闭未付款订单 -->
    <update id="updateByNoMoney" parameterType="Map">
        update t_mall_order set order_status = 5,update_time=now() where order_status=1
        <if test="minuteTime != null and minuteTime != ''">
            and TIMESTAMPDIFF(MINUTE,create_time,now()) > #{minuteTime}
        </if>
        <if test="shoplist != null ">
            and
            <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                shop_id = #{item.id,jdbcType=INTEGER}
            </foreach>
        </if>
        <if test="memberId != null and memberId != ''">
            and buyer_user_id = #{memberId}
        </if>
        <if test="id != null and id != ''">
            and id = #{id}
        </if>
        <if test="orderTypes != null and orderTypes != ''">
            and order_type != #{orderTypes}
        </if>
    </update>

    <select id="getOrderById" resultMap="MoreResultMap" parameterType="java.lang.Integer">
        select <include refid="Order_OrderDetail_List"></include> from t_mall_order t
        left join t_mall_order_detail d on d.order_id = t.id
        left join t_mall_store s on s.id = t.shop_id
        left join t_mall_product p on p.id=d.product_id
        where t.id = #{orderId}
    </select>

    <select id="getOrderByOrderPId" resultMap="MoreResultMap" parameterType="java.lang.Integer">
        select <include refid="Order_OrderDetail_List"></include> from t_mall_order t
        left join t_mall_order_detail d on d.order_id = t.id
        left join t_mall_store s on s.id = t.shop_id
        left join t_mall_product p on p.id=d.product_id
        where t.order_pid = #{orderId}
    </select>


    <select id="mobileOrderList" resultMap="MoreResultMap" parameterType="map">
        select
        <include refid="Buyer_Order_Column_List"/>
        from t_mall_order t
        left join t_mall_order_detail d ON (t.`shop_id`=d.`shop_id` AND t.`id`=d.`order_id`)
        left join t_mall_order_return re on re.order_detail_id=d.id
        left join t_mall_product p on p.id=d.product_id
        left join t_mall_store s on s.id = t.shop_id
        where t.shop_id > 0
        <if test="busUserId != null and busUserId != ''">
            and t.bus_user_id = #{busUserId}
        </if>
        <if test="memberId != null and memberId != ''  and (oldMemberIds == null)">
            and t.buyer_user_id = #{memberId}
        </if>
        <if test="oldMemberIds != null ">
            and
            <foreach collection="oldMemberIds" index="index" item="item" open="(" separator="or" close=")">
                t.buyer_user_id = #{item,jdbcType=INTEGER}
            </foreach>
        </if>
        <if test="orderType != null and orderType != ''">
            and t.order_type = #{orderType}
        </if>
        <if test="id != null and id != ''">
            and t.id=#{id}
        </if>
        <if test="type != null and type != '' and type != 0">
            and t.order_status = #{type}
        </if>
        <if test="appraiseStatus != null and appraiseStatus != ''">
            and d.appraise_status = #{appraiseStatus}
            <if test="appraiseStatus == 0"><!-- 查询未评价的订单(订单状态必须为已完成) -->
                and t.order_status = 4
            </if>
        </if>
        ORDER BY t.create_time desc,t.pay_time desc
        <if test="firstNum != null and maxNum != null">
            limit #{firstNum},#{maxNum}
        </if>
    </select>
    <select id="countMobileOrderList" resultType="java.lang.Integer" parameterType="map">
        select count(t.id) from t_mall_order t
        left join t_mall_order_detail d ON (t.`shop_id`=d.`shop_id` AND t.`id`=d.`order_id`)
        where 1=1 and t.shop_id > 0
        <if test="busUserId != null and busUserId != ''">
            and t.bus_user_id=#{busUserId}
        </if>
        <if test="memberId != null and memberId != ''  and (oldMemberIds == null )">
            and t.buyer_user_id = #{memberId}
        </if>
        <if test="oldMemberIds != null ">
            and
            <foreach collection="oldMemberIds" index="index" item="item" open="(" separator="or" close=")">
                t.buyer_user_id = #{item,jdbcType=INTEGER}
            </foreach>
        </if>
        <if test="orderType != null and orderType != ''">
            and t.order_type = #{orderType}
        </if>
        <if test="type != null and type != ''  and type != 0">
            and t.order_status = #{type}
        </if>
        <if test="appraiseStatus != null and appraiseStatus != ''">
            and d.appraise_status = #{appraiseStatus}
            <if test="appraiseStatus == 0"><!-- 查询未评价的订单(订单状态必须为已完成) -->
                and t.order_status = 4
            </if>
        </if>
    </select>


    <select id="selectOrderByOrderNo" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from t_mall_order t
        where t.order_no = #{orderNo}
    </select>

    <!-- 通过订单详情id查询订单信息 -->
    <select id="selectByDIdOrder" resultType="Map" parameterType="java.lang.Integer">
        select
        o.id as oId, d.id as dId ,d.det_pro_name as proName , d.det_pro_price*d.det_pro_num as proPrice,o.order_money as orderMoney,o.pay_time as payTime ,
        o.order_status as orderStatus,d.shop_id as shopId ,o.order_pid,o.is_wallet,o.bus_user_id,
        if(o.order_pid = 0 || o.order_pid is null,o.order_no,(SELECT  order_no from t_mall_order where o.order_pid=id)) as orderNo,
        d.product_id as productId,d.det_pro_num as proNum,o.buyer_user_id,o.order_pay_way,o.order_no,o.order_type,o.group_buy_id,d.product_specificas
        ,d.use_fenbi,d.use_jifen,d.total_price,o.receive_address,d.flow_id,d.flow_record_id
        from t_mall_order_detail d
        left join t_mall_order o on d.order_id = o.id
        where d.id = #{detailId}
    </select>

    <update id="upOrderByorderNo" parameterType="map">
        update t_mall_order
        <set>
            update_time = now(),
            <if test="status != null and status != ''">
                order_status = #{status},
            </if>
            <if test="transaction_id != null and transaction_id != ''">
                order_pay_no = #{transaction_id},
            </if>
            <if test="payTime != null and payTime != ''">
                pay_time = #{payTime},
            </if>
            <if test="isWallet != null and isWallet != ''">
                is_wallet = #{isWallet},
            </if>
            <if test="flowRechargeStatus != null">
                flow_recharge_status = #{flowRechargeStatus,jdbcType=INTEGER},
            </if>
        </set>
        where order_no = #{out_trade_no}
    </update>

    <update id="upOrderNoById" parameterType="com.gt.mall.entity.order.MallOrder">
        update t_mall_order
        <set>
            <if test="orderNo != null and orderNo != ''">
                order_no = #{orderNo},
            </if>
            <if test="giveStatus != null and giveStatus != ''">
                give_status = #{giveStatus},
            </if>
            <if test="orderMoney != null and orderMoney != ''">
                order_money = #{orderMoney},
            </if>
            <if test="isWallet != null and isWallet != ''">
                is_wallet = #{isWallet},
            </if>
            <if test="flowRechargeStatus != null">
                flow_recharge_status = #{flowRechargeStatus,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{id}
    </update>


    <select id="selectOrderPid" resultType="Map" parameterType="java.lang.Integer">
        SELECT id,shop_id,order_status,order_no FROM t_mall_order WHERE order_pid = #{orderId}
    </select>

    <select id="selectSpecByDetailId" resultType="java.lang.String" parameterType="java.lang.Integer">
        select group_concat(Convert(s.id , char)) as specId
        from  t_mall_order_detail d
        left join t_mall_product_specifica s on s.product_id=d.product_id and CONCAT(',',d.product_specificas,',') like CONCAT('%',CONCAT(',',s.specifica_value_id,','),'%')
        where d.id=#{detailId} and s.is_delete=0
    </select>

    <!-- 查询所有完成订单 -->
    <select id="selectOrderByFinish" resultMap="BaseResultMap">
        select t.order_no,t.id
        from t_mall_order t
        left join  t_mall_order_detail d ON (t.`shop_id`=d.`shop_id` AND t.`id`=d.`order_id`)
        where  t.shop_id > 0 and t.order_status=4 and d.return_day &lt;= TIMESTAMPDIFF(DAY,t.update_time,now()) and t.give_status=0 and mem_card_type > 0 and t.order_pay_way != 4
    </select>

    <select id="groupJoinPeopleNum" resultType="map" parameterType="map">
        select count(j.id) as num,if(j.p_join_id = 0,j.id,j.p_join_id) as pId
        from t_mall_group_join j
        right join t_mall_group_join j1 on j1.group_buy_id = j.group_buy_id
        and ( if(j.p_join_id > 0, j.id = j1.p_join_id  or j.id=j1.id or j.p_join_id = j1.p_join_id or j.p_join_id=j1.id,j.id = j1.p_join_id  or j.id=j1.id) )
        where j.group_buy_id=#{groupBuyId} and j.order_id = #{orderId}
    </select>
    <!-- 查询未支付的订单 -->
    <select id="selectNoPayOrder" parameterType="Map" resultMap="MoreResultMap">
        select
        <include refid="Order_OrderDetail_List"></include>
        from t_mall_order t
        left join t_mall_order_detail d on d.order_id = t.id
        left join t_mall_store s on s.id = t.shop_id
        left join t_mall_product p on p.id=d.product_id
        where t.order_status=1 and TIMESTAMPDIFF(MINUTE,t.create_time,now()) > #{times}
        <if test="orderType != null and orderType != ''">
            and order_type = #{orderType}
        </if>
        order by create_time
    </select>

    <select id="selectDetailByOrderId" parameterType="java.lang.Integer" resultType="Map">
        select t.id,t.product_id,t.product_image_url,t.det_pro_name,t.det_pro_price,t.det_pro_num,t.shop_id
        from t_mall_order o
        left join t_mall_order_detail t  on o.id=t.order_id
        where t.id>0 and (o.id = #{orderId} or o.order_pid=#{orderId} )
    </select>

    <select id="selectNoPayByPID" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        select count(id) from t_mall_order where order_pid = #{orderId} and order_status = 1
    </select>

    <select id="select_orderDetail" parameterType="Map" resultMap="orderDetailList">
        select * from t_mall_order_detail t
        where t.order_id IN (#{orderIds}) and (t.coupon_code != '' or t.use_fenbi > 0 or t.use_jifen > 0)
    </select>

    <!--  修改订单评价状态 -->
    <update id="uodAppraiseStatus" parameterType="com.gt.mall.entity.order.MallOrderDetail">
        update t_mall_order_detail set appraise_status = #{appraiseStatus} where id=#{id}
    </update>

    <select id="selectOrderByShopId" parameterType="Map" resultType="Map">
        select id,buyer_user_id,order_no,update_time,order_money
        from t_mall_order
        where order_status = 4 and order_pid = 0
        <if test="shoplist != null ">
            and
            <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                shop_id = #{item.id,jdbcType=INTEGER}
            </foreach>
        </if>
        order by buyer_user_id
    </select>

    <select id="explodOrder" resultMap="MoreResultMap" parameterType="map">
        SELECT
        DISTINCT(t.id), t.order_no,t.order_money, t.order_freight_money, t.order_status,t.create_time,t.order_pay_no,
        t.order_pay_way,t.order_buyer_message,t.order_seller_remark,t.receive_id,#{status} as status, t.delivery_method,
        t.receive_name ,t.receive_phone ,t.receive_address ,t.member_name,
        d.product_id,d.id AS dId,d.det_pro_num,d.det_pro_price,d.det_pro_name,d.det_privivilege,d.status,d.discounted_prices
        FROM t_mall_order t
        LEFT JOIN t_mall_order_detail d ON (t.`shop_id`=d.`shop_id` AND t.`id`=d.`order_id`)
        WHERE 1=1
        AND ((t.order_pay_way = 5 AND t.order_status != 1 AND t.order_status != 5) OR (t.order_pay_way!=5 AND d.id IS NOT NULL) )
        <if test="userId != null and userId != ''">
            and t.seller_user_id = #{userId}
        </if>
        <if test="startTime != null and startTime != ''">
            and t.create_time >= #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            and t.create_time <![CDATA[<=]]> #{endTime}
        </if>
        <if test="status != null and status != ''">
            <if test="status == 6 || status == 8">
                and ( d.status = 0 or d.status = 2 or d.status = 3 or d.status = 4 or d.status = -1) and t.order_status != 5
            </if>
            <if test="status == 7">
                and d.status != -3
            </if>
            <if test="status == 9">
                and (d.status = 1 or d.status = 5 or d.status = -2)
            </if>
            <if test="status &lt; 6">
                and t.order_status = #{status}
            </if>
        </if>
        <if test="orderType != 0">
            <if test="orderType == 1">and t.order_status = #{orderType}</if>
            <if test="orderType == 2">and t.delivery_method = #{orderType}</if>
            <if test="orderType == 3">and t.order_pay_way = 2</if>
        </if>
        <if test="orderFilter != 0">
            <if test="orderFilter == 1">and t.order_no = #{orderNo} <!-- like CONCAT(CONCAT('%', #{search}),'%') --></if>
            <if test="orderFilter == 2"><!-- and order_no = #{orderNo} --></if>
            <if test="orderFilter == 3">and t.receive_name = #{orderNo}</if>
            <if test="orderFilter == 4">and t.receive_phone = #{orderNo}</if>
            <if test="orderFilter == 5">and t.member_name = #{orderNo}</if>
        </if>
        <if test="shoplist != null ">
            and t.shop_id in
            <foreach collection="shoplist" index="index" item="item" open="(" separator="," close=")">
                #{item.id,jdbcType=INTEGER}
            </foreach>
        </if>
        ORDER BY t.create_time desc,t.pay_time desc
    </select>
    <!-- 用户购买商品的数量（用于限购） -->
    <select id="selectMemberBuyProNum" parameterType="Map" resultType="Integer">
        SELECT IFNULL(SUM(d.det_pro_num),0) FROM t_mall_order o
        LEFT JOIN t_mall_order_detail d ON d.`order_id`=o.`id`
        WHERE o.`order_status` > 1 AND o.order_status &lt; 5
        <if test="buyerUserId != null">
            AND o.`buyer_user_id` = #{buyerUserId}
        </if>
        <if test="productId != null">
            AND d.`product_id` = #{productId}
        </if>
        <if test="shopId != null">
            AND d.`shop_id` = #{shopId}
        </if>
    </select>

    <select id="getOrderByIdOrOne" resultMap="MoreResultMap" parameterType="java.lang.Integer">
        select <include refid="Order_OrderDetail_List"></include> from t_mall_order t
        left join t_mall_order_detail d on d.order_id = t.id
        left join t_mall_store s on s.id = t.shop_id
        left join t_mall_product p on p.id=d.product_id
        <if test="orderId != null and orderId != 0">
            where t.id = #{orderId}
        </if>
        <if test="orderId == null and orderId == 0">
            where t.order_status=4 and t.order_pay_way != 5
            order by t.create_time desc
            limit 1
        </if>
    </select>

    <update id="updateOrderMoney" parameterType="map">
        update t_mall_order set
        <if test="commission != null">
            order_money = order_money-#{commission}
        </if>
        where id = #{id}
    </update>

    <select id="selectSumSaleMoney" parameterType="java.lang.Integer" resultType="Map">
        SELECT IFNULL(SUM(order_money),0) as orderMoney FROM t_mall_order WHERE order_status = 4 AND order_pid = 0 AND buyer_user_id=#{buyerUserId}
    </select>

    <!-- 查询积分订单 -->
    <select id="selectIntegralOrder" parameterType="Map" resultType="Map">
        SELECT d.`det_pro_name`,d.`det_pro_num`,d.`det_pro_price`,o.`pay_time`,o.create_time,o.order_money
        FROM t_mall_order_detail d
        LEFT JOIN t_mall_order o ON o.`id`=d.`order_id`
        WHERE o.`order_type` = 2 AND d.id>0
        <if test="buyerUserId != null and buyerUserId != ''">
            and o.buyer_user_id=#{buyerUserId}
        </if>
        <if test="busUserId != null and busUserId != ''">
            and o.bus_user_id=#{busUserId}
        </if>
        <if test="productId != null and productId != ''">
            AND d.`product_id` = #{productId}
        </if>
        order by o.id desc
    </select>

    <select id="selectOrderFlow" resultType="Map">
        SELECT o.id,flow_recharge_status FROM t_mall_order o WHERE o.flow_recharge_status in(0,2)
    </select>

    <select id="selectMapById" resultType="Map">
        SELECT
        <include refid="Base_Column_List"/>
        FROM t_mall_order WHERE id = #{id}
    </select>

</mapper>
