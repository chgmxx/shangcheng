<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.mall.dao.basic.MallIncomeListDAO">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.gt.mall.entity.basic.MallIncomeList">
        <id column="id" property="id"/>
        <result column="income_type" property="incomeType"/>
        <result column="income_category" property="incomeCategory"/>
        <result column="income_money" property="incomeMoney"/>
        <result column="bus_id" property="busId"/>
        <result column="shop_id" property="shopId"/>
        <result column="create_time" property="createTime"/>
        <result column="pro_name" property="proName"/>
        <result column="pro_no" property="proNo"/>
        <result column="buyer_id" property="buyerId"/>
        <result column="buyer_name" property="buyerName"/>
        <result column="trade_id" property="tradeId"/>
        <result column="trade_type" property="tradeType"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, income_type AS incomeType, income_category AS incomeCategory, income_money AS incomeMoney, bus_id AS busId, shop_id AS shopId, create_time AS createTime, pro_name      AS proName, pro_no AS proNo, buyer_id AS buyerId, buyer_name AS buyerName, trade_id AS tradeId, trade_type AS tradeType
    </sql>
    <resultMap id="BaseResultMap1" type="Map">
        <result column="buyerName" property="buyerName" jdbcType="VARCHAR" typeHandler="com.gt.mall.bean.ConvertBlobTypeHandler"/>
    </resultMap>
    <select id="tradeCount" parameterType="map" resultType="java.lang.Integer">
        select count(*)
        FROM t_mall_income_list t
        WHERE  1=1
        <if test="incomeCategory != null and incomeCategory != ''">
            and t.income_category = #{incomeCategory}
        </if>
        <if test="userId != null and userId != ''">
            and t.bus_id = #{userId}
        </if>
        <if test="orderNo != null and orderNo != ''">
            and t.pro_no = #{orderNo}
        </if>
        <if test="startTime != null and startTime != ''">
            and DATE(t.create_time) >= #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            and DATE(t.create_time) <![CDATA[<=]]> #{endTime}
        </if>
        <if test="status != null and status != ''">
            AND t.income_type =#{status}
        </if>
        <if test="shoplist != null ">
            and
            <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                t.shop_id = #{item.id,jdbcType=INTEGER}
            </foreach>
        </if>
    </select>
    <select id="findByTradePage" parameterType="Map" resultMap="BaseResultMap1">
        select  id, income_type AS incomeType, income_category AS incomeCategory, income_money AS incomeMoney, bus_id AS busId, shop_id AS shopId, create_time AS createTime,                 pro_name AS proName, pro_no AS proNo, buyer_id AS buyerId, buyer_name AS buyerName, trade_id AS tradeId, trade_type AS tradeType
        FROM t_mall_income_list t
        WHERE  1=1
        <if test="incomeCategory != null and incomeCategory != ''">
            and t.income_category = #{incomeCategory}
        </if>
        <if test="userId != null and userId != ''">
            and t.bus_id = #{userId}
        </if>
        <if test="orderNo != null and orderNo != ''">
            and t.pro_no = #{orderNo}
        </if>
        <if test="startTime != null and startTime != ''">
            and DATE(t.create_time) >= #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            and DATE(t.create_time) <![CDATA[<=]]> #{endTime}
        </if>
        <if test="status != null and status != ''">
            AND t.income_type =#{status}
        </if>
        <if test="shoplist != null ">
            and
            <foreach collection="shoplist" index="index" item="item" open="(" separator="or" close=")">
                t.shop_id = #{item.id,jdbcType=INTEGER}
            </foreach>
        </if>
        order by t.create_time desc
        <if test="firstResult != null and maxResult != null">
            limit #{firstResult},#{maxResult}
        </if>
    </select>

</mapper>
