<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.mall.dao.product.MallProductDaycountDAO">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.gt.mall.entity.product.MallProductDaycount">
        <id column="id" property="id"/>
        <result column="shop_id" property="shopId"/>
        <result column="product_id" property="productId"/>
        <result column="sale_num" property="saleNum"/>
        <result column="sale_price" property="salePrice"/>
        <result column="sale_miprice" property="saleMiprice"/>
        <result column="sale_minum" property="saleMinum"/>
        <result column="sale_totalnum" property="saleTotalnum"/>
        <result column="sale_totalprice" property="saleTotalprice"/>
        <result column="refund_num" property="refundNum"/>
        <result column="refund_price" property="refundPrice"/>
        <result column="count_date" property="countDate"/>
        <result column="refund_minum" property="refundMinum"/>
        <result column="refund_miprice" property="refundMiprice"/>
        <result column="refund_totalnum" property="refundTotalnum"/>
        <result column="refund_totalprice" property="refundTotalprice"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, shop_id , product_id , sale_num , sale_price , sale_miprice , sale_minum , sale_totalnum ,
         sale_totalprice, refund_num , refund_price , count_date , refund_minum , refund_miprice,
         refund_totalnum , refund_totalprice
    </sql>
    <update id="updatetk" parameterType="com.gt.mall.entity.product.MallProductDaycount">
        update t_mall_product_daycount
        <set>

            <if test="refundNum != null">
                refund_num = #{refundNum,jdbcType=INTEGER},
            </if>
            <if test="refundPrice != null">
                refund_price = #{refundPrice,jdbcType=DECIMAL},
            </if>
            <if test="refundMinum != null">
                refund_minum = #{refundMinum,jdbcType=INTEGER},
            </if>
            <if test="refundMiprice != null">
                refund_miprice = #{refundMiprice,jdbcType=DECIMAL},
            </if>
            <if test="refundTotalnum != null">
                refund_totalnum = #{refundTotalnum,jdbcType=INTEGER},
            </if>
            <if test="refundTotalprice != null">
                refund_totalprice = #{refundTotalprice,jdbcType=DECIMAL},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <select id="isProductByDate" resultType="java.util.Map">
        SELECT id FROM t_mall_product_daycount
        WHERE product_id =#{productId}
        AND count_date =#{date}
    </select>
    <select id="selectShopIdByDate" resultType="java.util.Map">
        SELECT DISTINCT shop_id
        FROM t_mall_product_daycount
        WHERE count_date = #{date}
    </select>
    <select id="selectShopReturnListByDate" resultType="java.util.Map">
        SELECT SUM(sale_num) AS saleNum,SUM(sale_price) AS salePrice,SUM(sale_miprice) AS saleMiprice,SUM(sale_minum) AS saleMinum,SUM(sale_totalnum) AS saleTotalnum,SUM(sale_totalprice) AS saleTotalprice,
        SUM(refund_num) AS refundNum,SUM(refund_price) AS refundPrice,SUM(refund_minum) AS refundMinum,SUM(refund_miprice) AS refundMiprice,SUM(refund_totalnum) AS refundTotalnum,SUM(refund_totalprice) AS refundTotalprice
        FROM t_mall_product_daycount
        WHERE count_date = #{date}
        AND shop_id = #{shopId}
    </select>
    <select id="selectLastMonthProduct" resultType="java.util.Map">
        SELECT DISTINCT product_id,shop_id
        FROM t_mall_product_daycount
        WHERE #{startTime} > count_date
        AND count_date >=  #{endTime}
    </select>
    <select id="countLastMonthProduct" resultType="java.util.Map">
        SELECT SUM(sale_num) AS saleNum,SUM(sale_price) AS salePrice,SUM(sale_miprice) AS saleMiprice,SUM(sale_minum) AS saleMinum,SUM(sale_totalnum) AS saleTotalnum,SUM(sale_totalprice) AS saleTotalprice,
        SUM(refund_num) AS refundNum,SUM(refund_price) AS refundPrice,SUM(refund_minum) AS refundMinum,SUM(refund_miprice) AS refundMiprice,SUM(refund_totalnum) AS refundTotalnum,SUM(refund_totalprice) AS refundTotalprice
        FROM t_mall_product_daycount
        WHERE #{startTime} > count_date
        AND count_date >=  #{endTime}
        AND product_id = #{productId}
    </select>

</mapper>
